import requests
from bs4 import BeautifulSoup
import json

def extract_relevant_content(soup):
    relevant_content = []
    start_tag = soup.find('h2')
    end_tag = soup.find('div', {'id': 'footbar'})
    
    if start_tag and end_tag:
        current_tag = start_tag
        while current_tag and current_tag != end_tag:
            if current_tag.name in ['h2', 'h3', 'h4', 'p', 'ul', 'ol', 'li', 'table', 'tr', 'td']:
                relevant_content.append((current_tag.name, current_tag.get_text(strip=True)))
            current_tag = current_tag.find_next()
    
    return relevant_content

# Base URL and CWE IDs
base_url = 'https://cwe.mitre.org/data/definitions/
cwe_ids = ['22', '1241', '1341']  # Add more CWE IDs as needed

for cwe_id in cwe_ids:
    url = f'{base_url}{cwe_id}.html'
    response = requests.get(url)

    if response.status_code == 200:
        soup = BeautifulSoup(response.content, 'html.parser')
        relevant_content = extract_relevant_content(soup)

        messages = []

        message = {
            "role": "system",
            "content": "You are an expert in software security vulnerabilities and CWE classifications."
        }
        messages.append(message)
        
        content_str = ""
        for tag, text in relevant_content:
            content_str += f"{tag.upper()}: {text}\n"

        message = {
            "role": "user",
            "content": f"CWE-{cwe_id} Details:\n{content_str}"
        }
        messages.append(message)
        
        message = {
            "role": "assistant",
            "content": "Analysis and mitigation strategies based on the provided CWE details."
        }
        messages.append(message)
        
        json_filename = f"CWE_{cwe_id}.json"
        with open(json_filename, 'w') as json_file:
            json.dump({"messages": messages}, json_file, indent=4)
        
    else:
        print(f"Failed to retrieve content for CWE-{cwe_id}")

print("Scraping completed.")
